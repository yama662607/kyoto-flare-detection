# AGENTS.md

このドキュメントは、AI エージェントがこのプロジェクトで効率的に作業するためのガイドラインを提供します。

## 🤖 Justfile 利用ガイド

このプロジェクトでは**Justfile**を採用し、Python プロジェクトの品質管理と CI/CD を標準化しています。

### 📋 基本コマンド

| コマンド              | 説明                                 | 使用タイミング           |
| --------------------- | ------------------------------------ | ------------------------ |
| `just` / `just check` | 全体品質検証（format + lint + test） | 作業開始前、PR 作成前    |
| `just fix`            | 自動修正（format + lint --fix）      | エラー検出時の第一対応   |
| `just setup`          | 環境構築（依存関係インストール）     | 新規環境、依存関係更新時 |

### 🧪 テスト関連

| コマンド                    | 説明                 | 例                                 |
| --------------------------- | -------------------- | ---------------------------------- |
| `just test`                 | 全テスト実行         | -                                  |
| `just test path/to/file.py` | 特定ファイルのテスト | `just test tests/test_detector.py` |

### 🔧 個別タスク

| コマンド         | 説明                             | 用途               |
| ---------------- | -------------------------------- | ------------------ |
| `just fmt`       | コードフォーマット適用           | 手動フォーマット   |
| `just fmt-check` | フォーマット検証                 | CI でのチェック    |
| `just lint`      | 静的解析実行                     | コード品質確認     |
| `just lint-fix`  | Lint エラー自動修正              | 軽微なエラー対応   |
| `just clean`     | キャッシュ・アーティファクト削除 | 環境クリーンアップ |

### 🚀 開発・運用

| コマンド     | 説明             | 備考       |
| ------------ | ---------------- | ---------- |
| `just dev`   | 開発サーバー起動 | 現在未設定 |
| `just build` | 本番ビルド       | 現在未設定 |

## 🎯 AI エージェントの作業フロー

### 1. 作業開始時

```bash
just check  # 現在の品質状態を確認
```

### 2. コード変更後

```bash
just fix    # 自動修正を適用
just check  # 品質検証を実施
```

### 3. PR 作成前

```bash
just check && just test  # 全チェックを実施
```

### 4. 問題解決時

```bash
just fix    # まず自動修正を試行
# 解決しない場合は手動対応
```

## 📁 プロジェクト構造

```
kyoto-flare-detection/
├── justfile              # タスクランナー設定
├── pyproject.toml        # Pythonプロジェクト設定
├── src/                  # ソースコード
│   ├── base_flare_detector.py  # 基底クラス
│   ├── flarepy_DS_Tuc_A.py     # DS Tuc A 用実装
│   ├── flarepy_EK_Dra.py       # EK Dra 用実装
│   └── flarepy_V889_Her.py     # V889 Her 用実装
├── tests/                # テストコード
├── docs/                 # ドキュメント
├── notebooks/            # Jupyter Notebook
│   ├── flare_create_graphs.ipynb # メイン分析・グラフ生成
│   └── flare_detect_*.ipynb      # 各恒星のフレア検出・解析
├── outputs/              # 出力ファイル (figures/ 等)
│   └── debug/            # 実行ごとのデバッグ出力 (YYYYMMDD_HHMMSS)
└── tools/              # ユーティリティスクリプト
```

## ⚙️ ツール設定

- **パッケージマネージャー**: uv
- **フォーマッター**: Ruff format
- **Linter**: Ruff check
- **テスト**: pytest（最小構成のスモークテストあり）
- **対象ディレクトリ**: `src/`

## 🔄 CI/CD 連携

Justfile は以下の CI/CD プラクティスに準拠：

- **品質ゲート**: `just check`が CI の品質検証
- **自動修正**: `just fix`がエージェントの第一対応
- **標準化**: 全てのエージェントが同じコマンドを使用

## 📝 注意事項

- **引数パススルー**: `just test`や`just e2e`では引数を渡せます
- **環境変数**: `.env`ファイルを自動で読み込みます
- **エラー処理**: 各タスクは適切なエラーハンドリングを実装
- **未設定タスク**: `dev`や`build`はプロジェクト要件に応じて有効化

---

このガイドは、AI エージェントが一貫性のある高品質な作業を行うために定期的に更新してください。
